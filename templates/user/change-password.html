{% extends 'user/_base.html' %}
{% load static %}
{% block title %}Change Password{% endblock title %}

{% block extrastyle %}
<style>

</style>
{% endblock extrastyle %}

{% block content %}
<div class="content-body">
    <!-- Content -->
    <div class="container-xxl flex-grow-1 container-p-y">
        <div class="row">
            <div class="col-md-12">
                <ul class="nav nav-pills flex-column flex-md-row mb-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'user:change-password' %}"><i
                                class="fa fa-lock me-1"></i>Change Password</a>
                    </li>
                </ul>
                <div class="card mb-4">
                    <div class="card-body">
                        <form id="formAccountSettings" method="post">
                            {% csrf_token %}
                            <div class="row">
                                <div class="mb-3 col-md-6">
                                    <label for="oldPassword" class="form-label">Old Password</label>
                                    <input class="form-control" type="password" id="oldPassword" name="oldPassword"
                                        autofocus />
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input class="form-control" type="password" id="newPassword" name="newPassword" />
                                </div>
                                <div class="mb-3 col-md-12">
                                    <label for="re-enterPassword" class="form-label">Re-enter Password</label>
                                    <input class="form-control" type="password" id="re-enterPassword"
                                        name="re-enterPassword" />
                                </div>
                            </div>
                            <div class="mt-2">
                                <button type="submit" class="btn btn-primary me-2" id="changePasswordBtn">Change
                                    Password</button>
                                <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}


{% block javascript %}
<script>

    document.addEventListener('DOMContentLoaded', function () {

        document.getElementById("formAccountSettings").addEventListener("submit", async function (event) {

            event.preventDefault();

            formData = new FormData(this);
            formData['oldPassword'] = document.getElementById("oldPassword").value;
            formData['newPassword'] = document.getElementById("newPassword").value;
            formData['re-enterPassword'] = document.getElementById("re-enterPassword").value;
            console.log(formData);

            const response = await fetch("{% url 'user:handle-change-password' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': "{{ csrf_token }}",
                }
            })

            const responseData = await response.json();
            console.log(responseData)

            if (responseData.status === "success") {
                document.getElementById("changePasswordBtn").textContent = "Password changed"

                setTimeout(() => {
                    document.getElementById("changePasswordBtn").textContent = "Change Password"
                }, 3000)
            }
        })
    })
</script>
{% endblock javascript %}